# 生产服务器状态检查报告 (2026-01-22)

## 1. 摘要

经过检查和修复，生产环境（120.26.50.152）的所有关键服务（Nginx, PM2 Backend, Database）均已恢复正常运行。前端页面可正常访问，API 健康检查通过。

## 2. 详细状态

### 2.1 系统资源
- **运行时间**: 13天 5小时
- **负载**: 0.08 (低负载)
- **内存**: 已用 841MB / 总计 1613MB (52%)
- **磁盘**: 已用 9.6G / 总计 40G (26%)

### 2.2 服务状态
- **后端 (PM2)**:
  - 服务名: `webnote-backend`
  - 状态: `online`
  - 运行时间: ~10分钟
  - 内存占用: ~91MB
  - 监听端口: 3000
- **前端 (Nginx)**:
  - 状态: `active (running)`
  - 监听端口: 80
  - 根目录: `/var/www/webnote/web`
- **数据库 (SQLite)**:
  - 文件路径: `/var/www/webnote/backend/prisma/dev.db`
  - 状态: 文件存在且可读写，Prisma 连接正常。

### 2.3 健康检查结果
- [x] 后端本地访问 (`curl localhost:3000/health`): **OK** (200)
- [x] Nginx 代理访问 (`curl localhost/api/health`): **OK** (200)
- [x] 前端页面访问 (`curl localhost`): **OK** (200)

## 3. 修复记录

在检查过程中发现并修复了以下问题：

1.  **后端启动配置错误**:
    - **问题**: `package.json` 中的启动脚本指向 `dist/server.js`，但服务器上只部署了 `server.js` (无 `dist` 目录)。
    - **修复**: 修改 `package.json` 脚本为 `node server.js`。
2.  **共享模块路径错误**:
    - **问题**: `@webnote/shared` 包配置指向 `dist/` 目录，同样不存在。
    - **修复**: 修正 `node_modules/@webnote/shared/package.json` 的导出路径。
3.  **Nginx 前端路径错误**:
    - **问题**: Nginx 配置 `root /var/www/webnote/web/dist`，实际目录为 `/var/www/webnote/web`。
    - **修复**: 修改 Nginx 配置指向正确的 web 目录，并重载服务。

## 4. 后续建议

1.  **CI/CD 路径对齐**: 开发环境可能使用了 `tsc` 编译生成 `dist` 目录，但生产环境直接使用了源码（或未完整上传构建产物）。建议统一构建和部署流程，确保生产环境目录结构符合预期。
2.  **HTTPS 配置**: 当前服务运行在 HTTP (80) 端口，建议申请 SSL 证书并配置 Nginx 开启 HTTPS (443)。
3.  **备份验证**: 日志显示备份调度器已启动 (`backup_incremental`, `backup_full`)，建议定期检查 `/var/www/webnote/backend/backups` (或配置的 OSS) 确保备份文件实际生成。
