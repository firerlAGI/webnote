# T1项目后端API测试计划

## 1. 测试目标

对T1项目后端API进行全面测试，确保：
- 所有API接口功能正常
- 系统性能符合要求
- 安全性得到保障
- 用户流程完整可用

## 2. 测试范围

### 2.1 认证相关API测试
- 注册接口
- 登录接口
- 获取用户信息接口

### 2.2 笔记管理API测试
- 笔记CRUD操作
- 笔记搜索功能
- 笔记标签管理
- 笔记版本控制

### 2.3 复盘管理API测试
- 复盘CRUD操作
- 复盘统计功能
- 复盘模板管理
- 复盘历史查询

### 2.4 数据同步API测试
- 离线同步功能
- 冲突解决机制
- 批量操作支持

### 2.5 WebSocket功能测试
- 实时通知功能
- 连接管理

### 2.6 集成测试
- 完整用户流程测试

### 2.7 性能测试
- 响应时间测试
- 并发处理测试

### 2.8 安全测试
- 输入验证测试
- 权限控制测试

## 3. 测试环境

| 环境 | 配置 | 说明 |
|------|------|------|
| 开发环境 | Node.js 20+, PostgreSQL, Redis | 本地开发和测试 |
| 测试环境 | Docker容器化环境 | 模拟生产环境 |

## 4. 测试工具

| 测试类型 | 工具 | 版本 |
|---------|------|------|
| 单元测试 | Jest | ^29.0.0 |
| 集成测试 | Supertest | ^6.0.0 |
| 性能测试 | Artillery | ^2.0.0 |
| 安全测试 | OWASP ZAP | ^2.12.0 |
| WebSocket测试 | Socket.io-client | ^4.0.0 |

## 5. 测试用例设计

### 5.1 认证相关API测试用例

#### 5.1.1 用户注册测试
- **测试场景1**：正常注册
  - 输入：有效的用户名、邮箱、密码
  - 预期结果：注册成功，返回用户信息和JWT令牌
- **测试场景2**：邮箱已存在
  - 输入：已存在的邮箱
  - 预期结果：返回400错误，提示邮箱已存在
- **测试场景3**：密码强度不足
  - 输入：弱密码
  - 预期结果：返回400错误，提示密码强度不足

#### 5.1.2 用户登录测试
- **测试场景1**：正常登录
  - 输入：正确的邮箱和密码
  - 预期结果：登录成功，返回用户信息和JWT令牌
- **测试场景2**：密码错误
  - 输入：错误的密码
  - 预期结果：返回401错误，提示密码错误
- **测试场景3**：邮箱不存在
  - 输入：不存在的邮箱
  - 预期结果：返回401错误，提示邮箱或密码错误

#### 5.1.3 获取用户信息测试
- **测试场景1**：正常获取
  - 输入：有效的JWT令牌
  - 预期结果：返回用户信息
- **测试场景2**：未认证
  - 输入：无令牌
  - 预期结果：返回401错误，提示未认证
- **测试场景3**：令牌过期
  - 输入：过期的令牌
  - 预期结果：返回401错误，提示令牌过期

### 5.2 笔记管理API测试用例

#### 5.2.1 笔记CRUD测试
- **测试场景1**：创建笔记
  - 输入：有效的笔记标题和内容
  - 预期结果：创建成功，返回笔记信息
- **测试场景2**：获取笔记列表
  - 输入：有效的分页参数
  - 预期结果：返回笔记列表和分页信息
- **测试场景3**：更新笔记
  - 输入：有效的更新数据
  - 预期结果：更新成功，返回更新后的笔记信息
- **测试场景4**：删除笔记
  - 输入：有效的笔记ID
  - 预期结果：删除成功，返回成功消息

#### 5.2.2 笔记搜索测试
- **测试场景1**：关键词搜索
  - 输入：有效的搜索关键词
  - 预期结果：返回匹配的笔记列表
- **测试场景2**：空关键词
  - 输入：空关键词
  - 预期结果：返回所有笔记
- **测试场景3**：无匹配结果
  - 输入：不存在的关键词
  - 预期结果：返回空列表

#### 5.2.3 笔记标签测试
- **测试场景1**：添加标签
  - 输入：有效的标签名称
  - 预期结果：添加成功，返回更新后的笔记信息
- **测试场景2**：删除标签
  - 输入：有效的标签名称
  - 预期结果：删除成功，返回更新后的笔记信息

#### 5.2.4 笔记版本控制测试
- **测试场景1**：获取版本历史
  - 输入：有效的笔记ID
  - 预期结果：返回笔记的版本历史
- **测试场景2**：版本恢复
  - 输入：有效的版本ID
  - 预期结果：恢复成功，返回恢复后的笔记信息

### 5.3 复盘管理API测试用例

#### 5.3.1 复盘CRUD测试
- **测试场景1**：创建复盘
  - 输入：有效的复盘数据
  - 预期结果：创建成功，返回复盘信息
- **测试场景2**：获取复盘列表
  - 输入：无
  - 预期结果：返回复盘列表
- **测试场景3**：更新复盘
  - 输入：有效的更新数据
  - 预期结果：更新成功，返回更新后的复盘信息
- **测试场景4**：删除复盘
  - 输入：有效的复盘ID
  - 预期结果：删除成功，返回成功消息

#### 5.3.2 复盘统计测试
- **测试场景1**：获取统计信息
  - 输入：无
  - 预期结果：返回复盘统计数据

#### 5.3.3 复盘模板测试
- **测试场景1**：创建模板
  - 输入：有效的模板数据
  - 预期结果：创建成功，返回模板信息
- **测试场景2**：获取模板列表
  - 输入：无
  - 预期结果：返回模板列表
- **测试场景3**：更新模板
  - 输入：有效的更新数据
  - 预期结果：更新成功，返回更新后的模板信息
- **测试场景4**：删除模板
  - 输入：有效的模板ID
  - 预期结果：删除成功，返回成功消息

### 5.4 数据同步API测试用例

#### 5.4.1 同步功能测试
- **测试场景1**：同步笔记
  - 输入：有效的同步数据
  - 预期结果：同步成功，返回同步结果
- **测试场景2**：同步复盘
  - 输入：有效的同步数据
  - 预期结果：同步成功，返回同步结果
- **测试场景3**：批量同步
  - 输入：有效的批量同步数据
  - 预期结果：同步成功，返回同步结果

#### 5.4.2 冲突解决测试
- **测试场景1**：解决同步冲突
  - 输入：冲突数据和解决策略
  - 预期结果：冲突解决成功，返回解决结果

### 5.5 WebSocket功能测试用例

#### 5.5.1 实时通知测试
- **测试场景1**：笔记创建通知
  - 输入：创建笔记操作
  - 预期结果：接收到笔记创建通知
- **测试场景2**：笔记更新通知
  - 输入：更新笔记操作
  - 预期结果：接收到笔记更新通知
- **测试场景3**：笔记删除通知
  - 输入：删除笔记操作
  - 预期结果：接收到笔记删除通知

### 5.6 集成测试用例

#### 5.6.1 完整用户流程测试
- **测试场景1**：用户注册 -> 登录 -> 创建笔记 -> 搜索笔记 -> 创建复盘 -> 同步数据
  - 预期结果：整个流程成功完成

### 5.7 性能测试用例

#### 5.7.1 响应时间测试
- **测试场景1**：单用户并发请求
  - 输入：1个用户，每秒10个请求
  - 预期结果：95%的请求响应时间小于200ms

#### 5.7.2 并发处理测试
- **测试场景1**：多用户并发请求
  - 输入：100个用户，每秒100个请求
  - 预期结果：系统稳定运行，无错误

### 5.8 安全测试用例

#### 5.8.1 输入验证测试
- **测试场景1**：SQL注入测试
  - 输入：包含SQL注入攻击的请求
  - 预期结果：系统正确处理，无安全漏洞

#### 5.8.2 权限控制测试
- **测试场景1**：越权访问测试
  - 输入：尝试访问其他用户的资源
  - 预期结果：系统拒绝访问，返回403错误

## 6. 测试执行计划

### 6.1 测试准备
1. 安装测试工具
2. 配置测试环境
3. 准备测试数据

### 6.2 测试执行顺序
1. 单元测试
2. 集成测试
3. WebSocket测试
4. 性能测试
5. 安全测试
6. 集成测试（完整流程）

### 6.3 测试数据准备
- 测试用户账号
- 测试笔记数据
- 测试复盘数据
- 测试模板数据

## 7. 测试报告模板

### 7.1 测试摘要
- 测试时间
- 测试环境
- 测试范围
- 测试结果概览

### 7.2 详细测试结果
- 认证相关API测试结果
- 笔记管理API测试结果
- 复盘管理API测试结果
- 数据同步API测试结果
- WebSocket功能测试结果
- 集成测试结果
- 性能测试结果
- 安全测试结果

### 7.3 问题统计
- 严重问题
- 一般问题
- 轻微问题

### 7.4 改进建议
- 功能改进
- 性能优化
- 安全加固

## 8. 测试工具配置

### 8.1 Jest配置
```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  testMatch: ['**/test/**/*.test.ts'],
  collectCoverage: true,
  coverageDirectory: 'coverage',
};
```

### 8.2 Artillery配置
```yaml
config:
  target: 'http://localhost:3000'
  phases:
    - duration: 60
      arrivalRate: 10
      rampTo: 100
      name: 'Warming up'
  defaults:
    headers:
      Content-Type: 'application/json'
scenarios:
  - flow:
      - post:
          url: '/api/auth/login'
          json:
            email: 'test@example.com'
            password: 'password123'
          capture:
            json: '$token'
            as: 'token'
      - post:
          url: '/api/notes'
          headers:
            Authorization: 'Bearer {{ token }}'
          json:
            title: 'Test Note'
            content: 'Test Content'
```

### 8.3 Supertest测试示例
```javascript
const request = require('supertest');
const app = require('../src/app');

describe('Auth API', () => {
  it('should register a new user', async () => {
    const res = await request(app)
      .post('/api/auth/register')
      .send({
        username: 'testuser',
        email: 'test@example.com',
        password: 'password123'
      });
    expect(res.statusCode).toEqual(201);
    expect(res.body.success).toBe(true);
  });
});
```

## 9. 测试注意事项

1. **测试数据隔离**：确保测试数据与生产数据隔离
2. **测试环境一致性**：确保测试环境与生产环境配置一致
3. **测试覆盖率**：确保测试覆盖所有核心功能
4. **性能基准**：建立性能测试基准，便于后续对比
5. **安全测试**：定期进行安全测试，确保系统安全
6. **测试自动化**：尽量自动化测试流程，提高测试效率

## 10. 结论

本测试计划覆盖了T1项目后端API的所有核心功能，包括认证、笔记管理、复盘管理、数据同步、WebSocket功能、集成测试、性能测试和安全测试。通过执行本测试计划，可以确保系统的功能正确性、性能稳定性和安全性，为项目的顺利上线提供保障。
