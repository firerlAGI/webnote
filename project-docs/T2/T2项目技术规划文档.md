# T2项目技术规划文档

## 1. 项目概述

### 1.1 项目背景
WebNote是一个跨平台的笔记和复盘应用，采用现代化的前后端分离架构。T2项目是WebNote的前端Web应用核心功能开发阶段，旨在构建一个响应式、用户友好的网页应用，实现笔记管理和日复盘功能。

### 1.2 项目目标
- 构建基于React + TypeScript + Vite的现代化前端Web应用
- 实现完整的用户认证、笔记管理、Markdown编辑和日复盘功能
- 提供简洁、直观、响应式的用户界面
- 确保与后端API的无缝集成
- 优化前端性能和用户体验

### 1.3 项目范围
- **前端Web应用**：基于React的单页应用
- **核心功能**：用户认证、笔记管理、Markdown编辑、日复盘
- **技术栈**：React 18 + TypeScript 5 + Vite 5
- **集成**：与现有后端API和shared包集成

## 2. 技术架构设计

### 2.1 技术栈选择

| 类别 | 技术 | 版本 | 选型理由 |
|------|------|------|---------|
| 前端框架 | React | 18 | 组件化开发、生态成熟、性能优异 |
| 类型系统 | TypeScript | 5 | 类型安全、代码质量、开发体验 |
| 构建工具 | Vite | 5 | 快速开发体验、现代化构建流程 |
| 路由管理 | React Router | 6 | 声明式路由、代码分割、路由守卫 |
| 状态管理 | React Context API + useReducer | - | 轻量级、内置支持、适合中小型应用 |
| 数据验证 | Zod | 3 | 类型安全、强大的验证能力、良好的开发者体验 |
| 样式方案 | CSS Modules + PostCSS | - | 模块化、避免命名冲突、支持现代CSS特性 |
| HTTP客户端 | 封装的fetch API | - | 原生支持、轻量级、可扩展 |
| 包管理 | pnpm + Turborepo | - | 快速、节省空间、支持Monorepo结构 |

### 2.2 项目结构

```
packages/
├── web/                 # 前端Web应用
│   ├── public/          # 静态资源
│   ├── src/             # 源代码
│   │   ├── assets/      # 资源文件
│   │   ├── components/  # 通用组件
│   │   │   ├── common/  # 基础通用组件
│   │   │   ├── auth/    # 认证相关组件
│   │   │   ├── notes/   # 笔记相关组件
│   │   │   ├── folders/ # 文件夹相关组件
│   │   │   └── reviews/ # 复盘相关组件
│   │   ├── contexts/    # React Context
│   │   ├── hooks/       # 自定义Hooks
│   │   ├── layouts/     # 布局组件
│   │   ├── pages/       # 页面组件
│   │   ├── routes/      # 路由配置
│   │   ├── services/    # API服务
│   │   ├── types/       # TypeScript类型
│   │   ├── utils/       # 工具函数
│   │   ├── App.tsx      # 应用根组件
│   │   └── main.tsx     # 应用入口
│   ├── index.html       # HTML模板
│   ├── tsconfig.json    # TypeScript配置
│   ├── vite.config.ts   # Vite配置
│   └── package.json     # 项目配置
├── backend/             # 后端服务
└── shared/              # 共享代码
```

### 2.3 核心组件设计

#### 2.3.1 通用组件
- **Button**：按钮组件，支持多种样式和状态
- **Input**：输入框组件，支持表单验证
- **Card**：卡片组件，用于内容展示
- **Modal**：模态框组件，用于弹出操作
- **Alert**：通知组件，用于消息提示
- **Loader**：加载组件，用于异步操作
- **Dropdown**：下拉菜单组件
- **Tooltip**：工具提示组件
- **Avatar**：头像组件

#### 2.3.2 认证相关组件
- **LoginForm**：登录表单组件
- **RegisterForm**：注册表单组件
- **ForgotPasswordForm**：忘记密码表单组件
- **ResetPasswordForm**：重置密码表单组件
- **ProtectedRoute**：路由守卫组件

#### 2.3.3 笔记相关组件
- **NoteList**：笔记列表组件，支持分页和搜索
- **NoteCard**：笔记卡片组件，展示笔记摘要
- **NoteEditor**：笔记编辑器组件，集成Markdown编辑
- **NoteToolbar**：编辑器工具栏组件
- **NotePreview**：笔记预览组件
- **NoteSearch**：笔记搜索组件
- **NoteStatistics**：笔记统计组件

#### 2.3.4 文件夹相关组件
- **FolderList**：文件夹列表组件
- **FolderTree**：文件夹树组件
- **FolderForm**：文件夹表单组件
- **FolderContextMenu**：文件夹上下文菜单

#### 2.3.5 复盘相关组件
- **ReviewList**：复盘列表组件
- **ReviewCard**：复盘卡片组件
- **ReviewEditor**：复盘编辑器组件
- **ReviewStats**：复盘统计组件
- **ReviewAnalytics**：复盘分析组件
- **ReviewTemplate**：复盘模板组件

### 2.4 状态管理设计

#### 2.4.1 状态管理方案
使用React Context API + useReducer实现轻量级状态管理，避免引入复杂的状态管理库，适合中小型应用。

#### 2.4.2 Context设计
- **AuthContext**：管理用户认证状态
- **NotesContext**：管理笔记相关状态
- **FoldersContext**：管理文件夹相关状态
- **ReviewsContext**：管理复盘相关状态
- **UIContext**：管理UI相关状态（主题、布局等）

#### 2.4.3 状态结构
```typescript
// AuthState
interface AuthState {
  user: User | null;
  token: string | null;
  isLoading: boolean;
  error: string | null;
  isAuthenticated: boolean;
}

// NotesState
interface NotesState {
  notes: Note[];
  currentNote: Note | null;
  isLoading: boolean;
  error: string | null;
  searchQuery: string;
  filters: NoteFilters;
}

// FoldersState
interface FoldersState {
  folders: Folder[];
  currentFolder: Folder | null;
  isLoading: boolean;
  error: string | null;
}

// ReviewsState
interface ReviewsState {
  reviews: Review[];
  currentReview: Review | null;
  isLoading: boolean;
  error: string | null;
  stats: ReviewStats | null;
}

// UIState
interface UIState {
  theme: 'light' | 'dark';
  sidebarCollapsed: boolean;
  editorMode: 'edit' | 'preview' | 'split';
  notifications: Notification[];
}
```

### 2.5 路由设计

#### 2.5.1 路由结构
```
/
├── /auth
│   ├── /login          # 登录页面
│   ├── /register       # 注册页面
│   ├── /forgot-password # 忘记密码页面
│   └── /reset-password  # 重置密码页面
├── /notes              # 笔记列表页面
│   ├── /new            # 创建笔记页面
│   └── /:id            # 笔记详情页面
├── /folders            # 文件夹管理页面
│   ├── /new            # 创建文件夹页面
│   └── /:id            # 文件夹详情页面
├── /reviews            # 复盘列表页面
│   ├── /new            # 创建复盘页面
│   ├── /:id            # 复盘详情页面
│   └── /stats          # 复盘统计页面
├── /settings           # 设置页面
└── /profile            # 用户资料页面
```

#### 2.5.2 路由守卫
- **ProtectedRoute**：验证用户认证状态，未认证用户重定向到登录页面
- **AuthRoute**：验证用户未认证状态，已认证用户重定向到首页

### 2.6 API集成设计

#### 2.6.1 API客户端
使用shared包中的ApiClient进行API请求，封装了fetch API，提供统一的请求接口。

#### 2.6.2 API集成策略
- **认证API**：用户注册、登录、退出、获取用户信息
- **笔记API**：笔记CRUD、搜索、统计
- **文件夹API**：文件夹CRUD
- **复盘API**：复盘CRUD、统计、分析

#### 2.6.3 错误处理
- 统一的错误处理机制
- 友好的错误提示
- 网络错误重试策略

## 3. 功能模块设计

### 3.1 用户认证模块

#### 3.1.1 功能需求
- 用户注册：创建新用户账号
- 用户登录：验证用户凭证，获取认证令牌
- 忘记密码：通过邮箱重置密码
- 重置密码：设置新密码
- 退出登录：清除认证状态
- 获取用户信息：获取当前登录用户信息

#### 3.1.2 技术实现
- 使用JWT进行认证
- 密码加密存储
- 认证状态管理
- 路由守卫保护

#### 3.1.3 用户流程
```
用户注册 → 邮箱验证 → 用户登录 → 访问受保护资源 → 退出登录
```

### 3.2 笔记管理模块

#### 3.2.1 功能需求
- 笔记创建：创建新笔记
- 笔记编辑：编辑现有笔记
- 笔记查看：查看笔记详情
- 笔记删除：删除笔记
- 笔记搜索：按标题、内容搜索笔记
- 笔记分类：按文件夹组织笔记
- 笔记标签：为笔记添加标签
- 笔记置顶：置顶重要笔记
- 笔记统计：查看笔记统计信息

#### 3.2.2 技术实现
- Markdown编辑器集成
- 实时预览功能
- 语法高亮
- 自动保存
- 版本控制

#### 3.2.3 用户流程
```
查看笔记列表 → 选择笔记 → 编辑笔记 → 保存笔记 → 搜索/分类笔记
```

### 3.3 Markdown编辑模块

#### 3.3.1 功能需求
- 实时预览：编辑时实时显示预览效果
- 语法高亮：支持Markdown语法高亮
- 工具栏：提供常用编辑工具
- 快捷键：支持键盘快捷键
- 代码块：支持代码高亮
- 表格编辑：支持表格创建和编辑
- 图片上传：支持图片插入和上传

#### 3.3.2 技术实现
- 使用第三方Markdown编辑器库
- 自定义工具栏和快捷键
- 图片上传集成
- 代码高亮配置

#### 3.3.3 用户体验
- 响应式编辑器布局
- 流畅的编辑体验
- 直观的工具栏
- 清晰的预览效果

### 3.4 日复盘模块

#### 3.4.1 功能需求
- 复盘创建：创建每日复盘
- 复盘编辑：编辑现有复盘
- 复盘查看：查看复盘详情
- 复盘删除：删除复盘
- 复盘统计：查看复盘统计信息
- 复盘分析：分析复盘数据
- 复盘模板：使用和管理复盘模板
- 心情记录：记录每日心情

#### 3.4.2 技术实现
- 复盘数据存储
- 统计分析计算
- 模板管理
- 数据可视化

#### 3.4.3 用户流程
```
创建复盘 → 填写复盘内容 → 保存复盘 → 查看复盘历史 → 分析复盘数据
```

### 3.5 数据同步模块

#### 3.5.1 功能需求
- 实时同步：实时同步数据变更
- 离线编辑：支持离线状态下编辑
- 冲突解决：自动解决同步冲突
- 同步状态：显示同步状态和进度

#### 3.5.2 技术实现
- WebSocket集成
- 本地存储
- 冲突检测和解决
- 同步状态管理

#### 3.5.3 同步策略
- 增量同步：只同步变更数据
- 冲突解决：基于时间戳或用户选择
- 重试机制：网络恢复后自动重试

## 4. 界面设计与用户体验

### 4.1 设计原则
- **一致性**：统一的设计语言和交互模式
- **简洁性**：简洁明了的界面设计
- **可用性**：直观易用的用户界面
- **响应式**：适配不同设备屏幕尺寸

### 4.2 色彩系统

#### 4.2.1 主色调
- **主色**：#3B82F6（蓝色）
- **辅助色**：#10B981（绿色）、#F59E0B（橙色）、#EF4444（红色）

#### 4.2.2 中性色
- **白色**：#FFFFFF
- **浅灰**：#F3F4F6
- **中灰**：#9CA3AF
- **深灰**：#374151
- **黑色**：#111827

#### 4.2.3 暗色模式
- **背景**：#111827
- **表面**：#1F2937
- **文本**：#F9FAFB
- **边框**：#374151

### 4.3 字体系统
- **主要字体**：Inter
- **字体大小**：
  - 标题：24px、20px、18px、16px
  - 正文：16px、14px
  - 辅助文字：12px
- **行高**：
  - 标题：1.2
  - 正文：1.5
  - 辅助文字：1.4

### 4.4 布局系统
- **网格系统**：12列网格
- **间距系统**：
  - 基础间距：4px
  - 布局间距：8px、16px、24px、32px、48px
- **响应式断点**：
  - 移动端：< 640px
  - 平板：640px - 1024px
  - 桌面：> 1024px

### 4.5 导航设计
- **顶部导航**：应用标题、搜索栏、用户菜单
- **侧边导航**：功能模块导航
- **面包屑导航**：当前位置指示
- **底部导航**：版权信息、链接

### 4.6 交互设计
- **悬停效果**：按钮、卡片等元素的悬停状态
- **点击效果**：按钮点击反馈
- **过渡动画**：页面切换、组件显示/隐藏
- **加载状态**：异步操作的加载指示器
- **错误状态**：错误提示和处理
- **成功状态**：操作成功的反馈

### 4.7 响应式设计
- **移动端**：单栏布局，底部导航
- **平板**：双栏布局，侧边导航可折叠
- **桌面**：三栏布局，固定侧边导航

## 5. 性能优化策略

### 5.1 构建优化
- **代码分割**：基于路由的代码分割
- **Tree Shaking**：移除未使用的代码
- **压缩优化**：压缩JavaScript、CSS和HTML
- **预加载**：关键资源预加载
- **缓存策略**：合理的缓存配置

### 5.2 运行时优化
- **组件懒加载**：非首屏组件懒加载
- **虚拟滚动**：处理大量数据列表
- **防抖节流**：优化频繁事件处理
- **状态管理优化**：避免不必要的状态更新
- **内存管理**：避免内存泄漏

### 5.3 网络优化
- **API请求优化**：批量请求、缓存请求
- **资源加载优化**：使用CDN、合理的资源优先级
- **图片优化**：使用适当的图片格式和大小
- **字体优化**：字体子集、预加载
- **网络错误处理**：重试机制、离线支持

### 5.4 渲染优化
- **React.memo**：组件记忆化
- **useMemo**：计算结果缓存
- **useCallback**：函数记忆化
- **批量更新**：React 18的自动批处理
- **虚拟DOM优化**：避免不必要的DOM操作

## 6. 测试策略

### 6.1 测试类型
- **单元测试**：测试组件和函数
- **集成测试**：测试组件交互和API集成
- **E2E测试**：测试完整用户流程
- **性能测试**：测试应用性能
- **可访问性测试**：测试应用可访问性

### 6.2 测试工具
- **Vitest**：单元测试和集成测试
- **React Testing Library**：React组件测试
- **Cypress**：E2E测试
- **Lighthouse**：性能测试和可访问性测试

### 6.3 测试覆盖范围
- **核心组件**：通用组件、认证组件、笔记组件、复盘组件
- **关键功能**：用户认证、笔记CRUD、复盘CRUD
- **API集成**：与后端API的集成测试
- **边界情况**：错误处理、边界值测试

## 7. 项目实施计划

### 7.1 开发阶段
1. **阶段1：项目初始化**（1天）
   - 创建前端项目结构
   - 配置依赖和构建工具
   - 搭建基础开发环境

2. **阶段2：核心架构搭建**（2天）
   - 实现路由配置
   - 搭建状态管理
   - 实现认证系统
   - 创建通用组件库

3. **阶段3：功能模块开发**（6天）
   - 用户认证模块
   - 笔记管理模块
   - Markdown编辑模块
   - 日复盘模块
   - 数据同步模块

4. **阶段4：界面优化**（2天）
   - 响应式布局
   - 视觉风格统一
   - 交互体验优化

5. **阶段5：测试与修复**（2天）
   - 单元测试
   - 集成测试
   - E2E测试
   - 性能测试
   - Bug修复

### 7.2 里程碑
1. **里程碑1：前端项目初始化完成**
   - 项目结构搭建完成
   - 依赖配置正确
   - 基础路由设置完成
   - 开发环境运行正常

2. **里程碑2：用户认证功能完成**
   - 登录页面实现
   - 注册页面实现
   - 认证状态管理
   - 与后端API集成测试通过

3. **里程碑3：笔记核心功能完成**
   - 笔记列表展示
   - 笔记详情查看
   - Markdown编辑器集成
   - 笔记CRUD操作功能完整
   - 与后端API集成测试通过

4. **里程碑4：日复盘功能与响应式优化完成**
   - 日复盘创建与编辑
   - 复盘历史查看
   - 响应式布局适配
   - 界面简洁性优化
   - 整体功能测试通过

### 7.3 资源分配
- **前端架构师**：负责前端架构设计、核心功能开发
- **UI设计师**：负责界面设计、视觉风格
- **产品经理**：负责功能需求、用户体验
- **API测试专家**：负责API集成测试
- **性能专家**：负责性能优化

## 8. 风险控制与应对策略

### 8.1 潜在风险
1. **技术风险**：前端性能优化不足，影响用户体验
2. **集成风险**：与后端API集成问题
3. **设计风险**：界面简洁性与功能完整性平衡
4. **进度风险**：开发进度延迟
5. **质量风险**：测试覆盖不足，存在未发现的Bug

### 8.2 应对策略
1. **技术风险**：采用性能优化最佳实践，定期进行性能测试
2. **集成风险**：提前熟悉API文档，建立模拟数据，加强API测试
3. **设计风险**：UI设计师与前端架构师密切协作，进行用户测试
4. **进度风险**：合理规划开发阶段，设置明确的里程碑，定期进度检查
5. **质量风险**：建立完善的测试策略，提高测试覆盖率，进行代码审查

### 8.3 沟通机制
- **日常同步**：每日15分钟站会，同步进度和问题
- **技术评审**：关键功能实现前进行技术评审
- **里程碑检查**：每个里程碑完成后进行验收评审
- **问题追踪**：使用项目管理工具记录和追踪问题
- **文档共享**：维护项目文档，确保信息透明

## 9. 总结与展望

### 9.1 项目总结
T2项目是WebNote前端Web应用的核心功能开发阶段，通过本次技术规划，我们明确了项目目标、技术架构、功能模块和实施计划。项目采用React 18 + TypeScript 5 + Vite 5技术栈，构建现代化的前端Web应用，实现完整的用户认证、笔记管理、Markdown编辑和日复盘功能。

### 9.2 技术创新
- 采用React 18的新特性，如自动批处理、并发渲染
- 使用TypeScript确保类型安全
- 基于Vite的快速开发体验
- 轻量级状态管理方案
- 响应式设计和性能优化

### 9.3 未来展望
- **T3项目**：数据同步与存储优化
- **T4项目**：用户体验打磨
- **T5项目**：测试与验证
- **T6项目**：部署与监控
- **扩展功能**：浏览器扩展、移动应用
- **生态系统**：插件系统、API开放

通过T2项目的实施，WebNote将成为一个功能完整、性能优异、用户友好的现代化笔记和复盘应用，为用户提供高效、便捷的笔记管理和日复盘工具。