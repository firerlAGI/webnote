# 复盘历史功能设计方案

**文档版本**: 1.0  
**创建日期**: 2026-01-18  
**设计者**: Cline  
**状态**: 待实施

---

## 📋 功能概述

为 WebNote 添加独立的复盘历史页面，让用户可以：
- 浏览所有历史复盘记录
- 按日期范围和情绪筛选
- 查看复盘详情（包括雷达图、统计数据等）
- 编辑和删除复盘

## 🎯 问题分析

### 当前状况
- **后端**: ✅ 已就绪
  - 数据存储在 SQLite 数据库（`packages/backend/prisma/dev.db`）
  - 已有完整的 Review 模型和 API
  - 支持分页、筛选、CRUD 操作

- **前端**: ❌ 功能缺失
  - `ReviewPage.tsx` 只有今日复盘输入界面，使用 Mock 数据
  - **没有历史复盘列表视图**
  - **没有复盘详情查看功能**
  - 没有复盘管理功能（编辑、删除）

### 用户需求
用户发现无法查看每日复盘的历史文件，需要：
1. 历史复盘列表
2. 复盘详情查看
3. 编辑和删除功能
4. 筛选和搜索

## 🎨 设计方案：方案二（独立页面）

### 方案选择
**采用方案二**：创建独立的复盘历史页面

**理由**：
- 符合用户直觉（今日复盘 vs 历史复盘分开）
- 功能边界清晰
- 易于维护和扩展
- 不破坏现有页面结构

### UI 风格：赛博朋克

#### 色彩系统
```css
主色调：
- cyber-cyan (#00FFFF)      // 主要强调色
- cyber-pink (#FF00FF)      // 警告/删除
- cyber-yellow (#FFFF00)     // 重要信息
- cyber-panel (#0a0a0a)    // 卡片背景
- cyber-black (#000000)      // 页面背景

情绪评分颜色：
- 8-10: cyber-cyan (高情绪)
- 5-7: cyber-yellow (中等)
- 1-4: cyber-pink (低情绪)
```

#### 设计元素
```
边框风格：
- border-gray-800      // 普通边框
- border-cyber-cyan/50  // 激活/悬停
- border-dashed         // 占位/添加区域

背景效果：
- bg-cyber-black      // 主背景
- bg-cyber-panel      // 卡片背景
- bg-black/40-60      // 半透明背景
- bg-grid-pattern     // 网格背景

光效：
- glow效果（CyberButton）
- blur-sm (背景模糊)
- gradient (渐变边框)
```

#### 字体系统
```css
标题：font-display font-bold
标签：font-mono text-xs uppercase tracking-wider
正文：text-gray-200 font-sans
日期：font-mono text-sm
```

#### 动画效果
```css
页面进入：animate-in slide-in-from-bottom-5 duration-500
悬停效果：transition-all duration-200
加载动画：animate-spin-slow (图标)
```

## 🗂️ 文件结构

```
packages/web/src/
├── pages/
│   ├── ReviewPage.tsx          # 保留：今日复盘输入
│   └── ReviewHistoryPage.tsx    # 新建：复盘历史列表页
├── components/
│   ├── ReviewListCard.tsx       # 新建：列表项卡片
│   └── ReviewDetailModal.tsx    # 新建：详情弹窗
├── types.ts                    # 修改：添加新路由和类型
├── App.tsx                    # 修改：添加新路由
└── api/
    └── index.ts                # 已有：API方法完整
```

## 🎨 页面布局设计

### 复盘历史页面布局

```
┌─────────────────────────────────────────────────┐
│ HISTORY_LOG   // 页面标题                   │
├─────────────────────────────────────────────────┤
│ [日期范围] [情绪筛选] [搜索框]            │  // 筛选器
├─────────────────────────────────────────────────┤
│ 复盘列表（卡片网格或列表）：               │
│ ┌────────────────────────────────────┐      │
│ │ 2026-01-17  [情绪: 8]  📝      │      │
│ │ 完成度: 92%  核心任务：...      │      │
│ │ [编辑] [删除]                     │      │
│ └────────────────────────────────────┘      │
│ ┌────────────────────────────────────┐      │
│ │ 2026-01-16  [情绪: 7]  📝      │      │
│ │ ...                             │      │
│ └────────────────────────────────────┘      │
├─────────────────────────────────────────────────┤
│ [分页控件]                                │
└─────────────────────────────────────────────────┘
```

### 复盘详情弹窗

点击列表项后弹出，显示：
- 雷达图（生物指标）
- 统计数据（专注、体力、情绪）
- 核心任务和阻碍
- 详细复盘内容
- 附件（如果有）
- 编辑/删除按钮

```
┌──────────────────────────────────────────────┐
│ 头部：日期 + 关闭按钮 (X)            │
├──────────────────────────────────────────────┤
│ 左侧：雷达图 (StatRadar)             │
│ 右侧：详细内容                        │
│   - 核心任务                           │
│   - 系统阻碍                           │
│   - 详细复盘                           │
│   - 附件列表                           │
├──────────────────────────────────────────────┤
│ 底部：[编辑] [删除]                    │
└──────────────────────────────────────────────┘
```

## 🔧 技术实现

### 1. 新建 `ReviewHistoryPage.tsx`

```typescript
主要功能：
- 获取复盘列表（使用 reviewsAPI.getAll）
- 分页控制
- 筛选（日期范围、情绪）
- 搜索功能
- 删除确认

组件结构：
- 筛选器区域
- 复盘列表
- 分页控件
- 加载状态
- 空状态
```

### 2. 新建 `ReviewListCard.tsx` 组件

```typescript
显示内容：
- 日期
- 情绪评分（带颜色标识）
- 核心任务预览
- 完成度统计（专注、体力、情绪）
- 操作按钮（编辑、删除）

样式特点：
- bg-cyber-panel 边框
- 悬停：border-cyber-cyan/50 + glow效果
- 情绪评分进度条
```

### 3. 新建 `ReviewDetailModal.tsx` 组件

```typescript
显示内容：
- 完整复盘信息
- 雷达图（复用 StatRadar）
- 统计数据卡片
- 编辑/删除操作
- 关闭按钮

样式特点：
- 背景模糊：backdrop-blur-md
- 雷达图边框：border-cyber-cyan/30
- 删除按钮：CyberButton variant="danger"
```

### 4. 修改 `types.ts`

```typescript
- 添加 REVIEW_HISTORY = '/review/history' 到 AppRoute 枚举
```

### 5. 修改 `Sidebar.tsx`

```typescript
- 在导航项中添加：
  { label: '复盘历史_History', icon: History, route: AppRoute.REVIEW_HISTORY }
```

### 6. 修改 `App.tsx`

```typescript
- 添加路由：<Route path="/review/history" element={<ReviewHistoryPage />} />
```

## 📦 API 使用

### 已有 API 方法（无需修改）

```typescript
// 获取列表（支持筛选、分页）
reviewsAPI.getAll({
  start_date?: string;
  end_date?: string;
  mood?: string;
  page?: number;
  limit?: number;
})

// 获取详情
reviewsAPI.getById(id: number)

// 更新
reviewsAPI.update(id, data)

// 删除
reviewsAPI.delete(id)

// 获取统计数据
reviewsAPI.getStats({ start_date, end_date })
```

## 🎯 核心特性

### 1. 筛选功能
- **日期范围选择器**
  - 开始日期 - 结束日期
  - 默认显示最近 30 天
  
- **情绪筛选**
  - 全部
  - 高情绪 (8-10)
  - 中等 (5-7)
  - 低情绪 (1-4)
  
- **关键词搜索**
  - 搜索核心任务、系统阻碍、复盘内容

### 2. 分页功能
- 每页显示 10-20 条
- 上一页/下一页/页码跳转
- 显示总数和当前页

### 3. 详情查看
- 点击卡片打开弹窗
- 显示完整信息（雷达图、统计数据）
- 支持编辑和删除

### 4. 删除保护
- 删除前确认弹窗
- 防止误删

### 5. 响应式设计
- **移动端**：单列布局，详情弹窗全屏
- **桌面端**：双列或网格布局，详情弹窗居中
- **大屏**：三列布局，更多信息展示

## 🎨 组件复用

### 直接复用现有组件
- ✅ `CyberCard` - 卡片容器
- ✅ `CyberInput` - 输入框（搜索）
- ✅ `CyberButton` - 按钮（编辑、删除、分页）
- ✅ `StatRadar` - 雷达图
- ✅ 图标：`Brain`, `Activity`, `Smile`, `Calendar`, `History`, `Edit`, `Trash2`

## ✨ 细节优化

### 1. 卡片悬停效果
```css
hover:border-cyber-cyan/50
hover:shadow-[0_0_20px_rgba(0,255,255,0.1)]
transition-all duration-200
```

### 2. 情绪评分视觉化
- 使用进度条显示（cyber-cyan 颜色）
- 高情绪：cyan + glow
- 低情绪：pink + 警告

### 3. 完成度展示
- 专注度：cyber-cyan 进度条
- 体力：cyber-pink 进度条
- 情绪：cyber-yellow 星级

### 4. 空状态设计
```
┌─────────────────────────────────────┐
│     [空数据图标]                  │
│   NO_DATA_DETECTED                │
│   暂无复盘记录                    │
│   [创建第一篇复盘]                  │
└─────────────────────────────────────┘
```

### 5. 加载动画
```tsx
// 骨架屏加载
<div className="animate-pulse bg-cyber-panel ...">
```

### 6. 删除确认
```tsx
// 红色警告样式
bg-cyber-pink/10 border-cyber-pink/50
text-cyber-pink
```

### 7. 成功提示
```tsx
// 绿色成功样式
bg-cyber-cyan/10 border-cyber-cyan/50
text-cyber-cyan
```

## 📱 响应式适配

### 移动端 (< 768px)
- 单列卡片布局
- 详情弹窗全屏显示
- 筛选器堆叠排列

### 桌面端 (≥ 768px)
- 双列卡片布局
- 详情弹窗居中显示
- 筛选器横向排列

### 大屏 (≥ 1024px)
- 三列卡片布局
- 更多信息展示

## 🚀 开发步骤

### 阶段一：基础框架
1. 创建 `ReviewHistoryPage.tsx` 主页面
2. 创建 `ReviewListCard.tsx` 列表项组件
3. 创建 `ReviewDetailModal.tsx` 详情弹窗组件

### 阶段二：核心功能
4. 实现列表功能（获取数据、渲染列表、分页）
5. 实现筛选功能（日期范围、情绪筛选、搜索）
6. 实现详情查看（弹窗显示、雷达图集成）

### 阶段三：操作功能
7. 实现编辑功能
8. 实现删除功能（含确认）
9. 集成到路由系统（types.ts, Sidebar.tsx, App.tsx）

### 阶段四：优化完善
10. 样式优化（赛博朋克风格、动画效果）
11. 响应式设计（移动端、桌面端、大屏适配）
12. 功能测试（功能测试、API 集成测试、响应式测试）

## 📝 实现检查清单

### 组件设计
确保每个组件：
- ✅ 使用 CyberCard/CyberInput/CyberButton
- ✅ 色彩遵循 cyber-cyan/cyber-pink/cyber-yellow
- ✅ 字体使用 font-display/font-mono
- ✅ 动画使用 animate-in/transition-all
- ✅ 背景使用 cyber-panel/cyber-black
- ✅ 边框使用 border-gray-800
- ✅ 光效使用 glow/blur

### 功能完整性
- ✅ 列表显示正确
- ✅ 筛选功能正常
- ✅ 分页功能正常
- ✅ 详情查看完整
- ✅ 编辑功能正常
- ✅ 删除功能正常（含确认）
- ✅ 空状态处理
- ✅ 加载状态处理
- ✅ 错误状态处理

### 响应式设计
- ✅ 移动端适配
- ✅ 桌面端适配
- ✅ 大屏适配

### API 集成
- ✅ 正确调用 reviewsAPI
- ✅ 正确处理响应数据
- ✅ 正确处理错误情况

## 💡 额外建议（未来扩展）

### 1. 从 ReviewPage 跳转
- 在今日复盘页面添加"查看历史"按钮
- 跳转到复盘历史页面

### 2. 快速统计
- 页面顶部显示总复盘数
- 平均情绪评分
- 最近一周趋势

### 3. 导出功能（可选）
- 导出复盘数据为 CSV/JSON
- 方便数据分析

### 4. 批量操作（可选）
- 批量删除
- 批量导出

### 5. 时间轴视图（可选）
- 按时间轴展示复盘
- 可视化趋势变化

## 📊 数据流程

```
用户进入复盘历史页面
    ↓
加载复盘列表（reviewsAPI.getAll）
    ↓
显示列表（带分页）
    ↓
用户操作：
    - 点击卡片 → 打开详情弹窗（reviewsAPI.getById）
    - 编辑 → 打开编辑表单 → 保存（reviewsAPI.update）
    - 删除 → 确认 → 删除（reviewsAPI.delete）
    - 筛选 → 更新筛选条件 → 重新获取列表
    - 搜索 → 输入关键词 → 重新获取列表
    - 分页 → 切换页码 → 重新获取列表
```

## 🔐 安全考虑

### 1. 权限控制
- 只能查看自己的复盘
- 编辑和删除需要权限验证

### 2. 数据验证
- 前端：输入验证
- 后端：参数验证（已实现）

### 3. 删除保护
- 删除前确认
- 防止误删

## 📈 性能优化

### 1. 数据缓存
- 使用 React.memo 优化列表项渲染
- 使用 useMemo 优化计算

### 2. 懒加载
- 列表分页加载
- 图片懒加载（附件）

### 3. 防抖
- 搜索输入防抖（300ms）
- 筛选条件防抖（300ms）

## 🎯 成功指标

- ✅ 用户可以查看所有历史复盘
- ✅ 用户可以筛选复盘记录
- ✅ 用户可以查看复盘详情
- ✅ 用户可以编辑复盘
- ✅ 用户可以删除复盘
- ✅ 界面符合赛博朋克风格
- ✅ 响应式设计适配良好
- ✅ API 集成正常

## 📚 参考资料

### 现有组件
- `ReviewPage.tsx` - 今日复盘页面
- `CyberUI.tsx` - UI 组件库
- `SystemCharts.tsx` - 图表组件

### API 文档
- `packages/backend/src/api/routes.ts` - 后端路由
- `packages/web/src/api/index.ts` - 前端 API

### 设计规范
- `packages/web/src/index.css` - 全局样式
- `project-docs/响应式布局分析报告_20260118.md` - 响应式设计

---

**文档结束**

下一步：切换到 Act Mode 开始实现
