# WebNote 项目开发规范

## 1. 项目概述

WebNote是一个跨平台的笔记和复盘应用，支持Web应用、浏览器扩展和移动应用，提供笔记管理、文件夹分类、标签管理、版本控制、复盘功能和数据同步等核心功能。

## 2. 技术栈

- **前端框架**: React + TypeScript
- **构建工具**: Vite
- **状态管理**: React Context API + useReducer
- **UI组件**: 自定义组件库
- **HTTP客户端**: 封装的fetch API
- **数据验证**: Zod
- **样式**: CSS Modules + PostCSS
- **包管理**: pnpm + Turborepo
- **代码规范**: ESLint + Prettier + TypeScript

## 3. 项目结构

```
webnote/
├── packages/
│   ├── shared/           # 公共代码包
│   │   ├── types/        # TypeScript类型定义
│   │   ├── utils/        # 工具函数
│   │   ├── api/          # API客户端
│   │   └── constants/    # 常量定义
│   ├── web-app/          # Web应用
│   ├── browser-extension/ # 浏览器扩展
│   ├── backend/          # 后端服务
│   └── ui-components/    # UI组件库
├── docs/                 # 项目文档
├── scripts/              # 脚本工具
└── config/               # 配置文件
```

## 4. 编码规范

### 4.1 TypeScript规范

- **类型定义**: 优先使用接口(interface)定义对象类型，使用类型别名(type)定义联合类型、交叉类型等
- **严格模式**: 启用strict模式，避免使用any类型
- **空值处理**: 使用可选链(?.)和空值合并(??)运算符处理可能为null/undefined的值
- **类型断言**: 尽量避免使用as断言，优先使用类型守卫
- **泛型**: 合理使用泛型提高代码复用性

### 4.2 React规范

- **组件命名**: 使用PascalCase命名组件，文件名为组件名
- **组件类型**: 优先使用函数组件，配合React hooks
- **Hooks使用**: 遵循Hooks规则，只在组件顶层调用Hooks
- **Props命名**: 使用camelCase命名props
- **状态管理**: 优先使用React Context API + useReducer，避免过度使用Redux
- **样式**: 使用CSS Modules，类名为camelCase
- **组件拆分**: 合理拆分组件，保持组件职责单一

### 4.3 代码风格

- **缩进**: 使用2个空格缩进
- **分号**: 必须使用分号
- **引号**: 使用单引号
- **变量命名**: 使用camelCase命名变量和函数，使用PascalCase命名类和接口，使用UPPER_CASE命名常量
- **行长度**: 每行不超过100个字符
- **空行**: 在逻辑块之间使用空行分隔
- **注释**: 为复杂逻辑添加注释，使用JSDoc注释函数和接口

### 4.4 命名规范

- **文件命名**: 使用kebab-case命名文件和目录
- **变量命名**: 含义明确，避免使用缩写
- **函数命名**: 动词开头，如getUser, updateNote
- **组件命名**: 名词或形容词开头，如NoteList, AddButton
- **常量命名**: 全大写，下划线分隔，如API_BASE_URL

## 5. 开发流程

### 5.1 分支管理

- **main**: 主分支，用于发布生产版本
- **develop**: 开发分支，用于集成功能
- **feature/xxx**: 功能分支，用于开发新功能
- **bugfix/xxx**: 修复分支，用于修复bug
- **release/xxx**: 发布分支，用于准备发布

### 5.2 提交规范

使用Conventional Commits规范：

```
<type>(<scope>): <description>

<body>

<footer>
```

- **type**: feat(新功能)、fix(修复bug)、docs(文档)、style(样式)、refactor(重构)、test(测试)、chore(构建)
- **scope**: 功能模块名称
- **description**: 简短描述
- **body**: 详细描述
- **footer**: 关闭的issue或破坏性变更

示例：
```
feat(notes): 增加笔记搜索功能

- 实现笔记标题和内容搜索
- 添加搜索结果高亮
- 支持按创建时间排序

closes #123
```

### 5.3 代码审查

- 所有代码变更必须通过Pull Request
- 至少需要1个审核人员批准
- 确保代码符合规范
- 确保通过所有测试

## 6. 测试规范

### 6.1 测试类型

- **单元测试**: 测试单个函数或组件
- **集成测试**: 测试多个组件或模块的交互
- **端到端测试**: 测试完整的用户流程

### 6.2 测试工具

- **单元测试**: Jest + React Testing Library
- **端到端测试**: Cypress

### 6.3 测试覆盖率

- 核心功能覆盖率达到80%以上
- 工具函数和API客户端覆盖率达到90%以上

## 7. 性能优化

### 7.1 前端性能

- 代码分割和懒加载
- 优化组件渲染，使用React.memo, useMemo, useCallback
- 图片优化，使用适当的格式和大小
- 减少HTTP请求，合理使用缓存
- 避免不必要的重渲染

### 7.2 后端性能

- 数据库索引优化
- API响应缓存
- 分页查询
- 异步处理
- 负载均衡

## 8. 安全规范

### 8.1 前端安全

- XSS防护：使用React的自动转义
- CSRF防护：使用SameSite Cookie
- 输入验证：所有用户输入必须验证
- 敏感数据：不在前端存储敏感数据

### 8.2 后端安全

- 认证和授权：使用JWT
- 密码加密：使用bcrypt或Argon2
- SQL注入防护：使用参数化查询
- 速率限制：防止暴力攻击
- 日志审计：记录关键操作

## 9. 部署流程

### 9.1 构建流程

1. 安装依赖：`pnpm install`
2. 构建：`pnpm build`
3. 测试：`pnpm test`
4. 代码检查：`pnpm lint`

### 9.2 部署环境

- **开发环境**: http://localhost:3000
- **测试环境**: https://test.webnote.com
- **生产环境**: https://webnote.com

### 9.3 部署方式

- **Web应用**: 使用Vercel或Netlify部署
- **浏览器扩展**: 打包后提交到Chrome Web Store和Firefox Add-ons
- **后端服务**: 使用Docker容器化部署到云服务器

## 10. 文档规范

- 项目架构文档
- API文档
- 开发规范文档
- 用户手册
- 变更日志

## 11. 团队协作

- 使用Slack进行沟通
- 使用Jira进行任务管理
- 每周召开团队会议
- 定期进行代码审查
- 分享技术知识

## 12. 持续集成/持续部署

- 使用GitHub Actions进行CI/CD
- 自动运行测试和代码检查
- 自动构建和部署
- 监控和告警

# 总结

本规范旨在确保WebNote项目的代码质量、可维护性和可扩展性。所有团队成员必须严格遵守本规范，共同建设高质量的项目。
