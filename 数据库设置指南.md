# WebNote æ•°æ®åº“è®¾ç½®æŒ‡å—

## å½“å‰çŠ¶æ€

- âœ… åç«¯æœåŠ¡å™¨ï¼šè¿è¡Œä¸­ï¼ˆhttp://127.0.0.1:3000ï¼‰
- âœ… å‰ç«¯æœåŠ¡å™¨ï¼šè¿è¡Œä¸­ï¼ˆhttp://localhost:3000ï¼‰
- âŒ PostgreSQLæ•°æ®åº“ï¼šæœªè¿è¡Œ
- ğŸ“Š å½“å‰çŠ¶æ€ï¼šä½¿ç”¨Mockæ•°æ®fallback

## æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨Dockerï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•å¿«é€Ÿçš„æ–¹å¼ã€‚

### 1. å®‰è£…Docker Desktop
- macOS: https://www.docker.com/products/docker-desktop
- ä¸‹è½½å¹¶å®‰è£…åå¯åŠ¨Docker Desktop

### 2. å¯åŠ¨PostgreSQLå®¹å™¨

```bash
# åˆ›å»ºæ•°æ®å·ï¼ˆæŒä¹…åŒ–æ•°æ®ï¼‰
docker volume create pgdata

# å¯åŠ¨PostgreSQLå®¹å™¨
docker run -d \
  --name webnote-postgres \
  -e POSTGRES_USER=admin \
  -e POSTGRES_PASSWORD=password \
  -e POSTGRES_DB=example_db \
  -p 5432:5432 \
  -v pgdata:/var/lib/postgresql/data \
  postgres:14-alpine
```

### 3. éªŒè¯å®¹å™¨è¿è¡Œ

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep webnote-postgres

# æŸ¥çœ‹æ—¥å¿—
docker logs webnote-postgres

# æµ‹è¯•è¿æ¥
docker exec -it webnote-postgres psql -U admin -d example_db -c "SELECT 1;"
```

### 4. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
cd packages/backend

# ç”Ÿæˆå¹¶è¿è¡Œè¿ç§»
npx prisma migrate dev --name init

# æˆ–è€…å¦‚æœè¿ç§»æ–‡ä»¶å·²å­˜åœ¨
npx prisma migrate deploy
```

### 5. é‡å¯åç«¯æœåŠ¡

```bash
# åœæ­¢å½“å‰è¿è¡Œçš„åç«¯ï¼ˆCtrl+Cï¼‰
# ç„¶åé‡æ–°å¯åŠ¨
cd packages/backend
npm run dev
```

### 6. æ¸…ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker stop webnote-postgres
docker rm webnote-postgres

# åˆ é™¤æ•°æ®å·ï¼ˆæ…ç”¨ï¼Œä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
docker volume rm pgdata
```

## æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Homebrewå®‰è£…

### 1. å®‰è£…PostgreSQL

```bash
# å®‰è£…PostgreSQL 14
brew install postgresql@14

# å¯åŠ¨PostgreSQLæœåŠ¡
brew services start postgresql@14
```

### 2. åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

```bash
# è¿æ¥åˆ°PostgreSQL
psql postgres

# æ‰§è¡Œä»¥ä¸‹SQLå‘½ä»¤
CREATE USER admin WITH PASSWORD 'password';
CREATE DATABASE example_db OWNER admin;
GRANT ALL PRIVILEGES ON DATABASE example_db TO admin;
\q
```

### 3. è¿è¡Œè¿ç§»

```bash
cd packages/backend
npx prisma migrate dev --name init
```

### 4. é‡å¯åç«¯æœåŠ¡

```bash
cd packages/backend
npm run dev
```

## æ–¹æ¡ˆä¸‰ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨

å¦‚æœæ‚¨çš„æœåŠ¡å™¨ï¼ˆ120.26.50.152ï¼‰å·²ç»é…ç½®å¥½æ•°æ®åº“ï¼Œå¯ä»¥ç›´æ¥éƒ¨ç½²ï¼š

```bash
# ä¸€é”®éƒ¨ç½²
./scripts/deploy.sh
```

## éªŒè¯æ•°æ®åº“è¿æ¥

### 1. æ£€æŸ¥åç«¯æ—¥å¿—

åç«¯å¯åŠ¨æ—¶ä¼šè¾“å‡ºæ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ã€‚

### 2. æµ‹è¯•APIç«¯ç‚¹

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://127.0.0.1:3000/api/health

# æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
curl -X POST http://127.0.0.1:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","email":"test@example.com","password":"password123"}'
```

### 3. æ£€æŸ¥æ•°æ®åº“å†…å®¹

```bash
# å¦‚æœä½¿ç”¨Docker
docker exec -it webnote-postgres psql -U admin -d example_db

# å¦‚æœä½¿ç”¨Homebrewå®‰è£…çš„PostgreSQL
psql -U admin -d example_db

# æŸ¥çœ‹æ‰€æœ‰è¡¨
\dt

# æŸ¥çœ‹ç”¨æˆ·è¡¨
SELECT * FROM users;

# é€€å‡º
\q
```

## åˆå§‹åŒ–æ•°æ®ï¼ˆå¯é€‰ï¼‰

å¦‚æœæƒ³åˆ›å»ºä¸€äº›æµ‹è¯•æ•°æ®ï¼š

```bash
cd packages/backend

# é‡ç½®æ•°æ®åº“ï¼ˆåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
npx prisma migrate reset

# æˆ–è€…ä½¿ç”¨seedè„šæœ¬ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
npx prisma db seed
```

## å¸¸è§é—®é¢˜

### Q1: ç«¯å£5432å·²è¢«å ç”¨

```bash
# macOS: æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :5432

# å¦‚æœè¢«å ç”¨ï¼Œå¯ä»¥ï¼š
# 1. åœæ­¢å ç”¨è¿›ç¨‹
# 2. æˆ–è€…ä½¿ç”¨å…¶ä»–ç«¯å£ï¼ˆä¿®æ”¹.envå’Œdockerå‘½ä»¤ä¸­çš„ç«¯å£æ˜ å°„ï¼‰
```

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥

æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š
1. PostgreSQLæ˜¯å¦æ­£åœ¨è¿è¡Œ
2. `.env`æ–‡ä»¶ä¸­çš„DATABASE_URLæ˜¯å¦æ­£ç¡®
3. ç”¨æˆ·åã€å¯†ç ã€æ•°æ®åº“åæ˜¯å¦åŒ¹é…
4. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢è¿æ¥

### Q3: è¿ç§»å¤±è´¥

```bash
# æŸ¥çœ‹è¿ç§»çŠ¶æ€
npx prisma migrate status

# é‡ç½®æ•°æ®åº“ï¼ˆæ…ç”¨ï¼Œä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
npx prisma migrate reset

# å¼ºåˆ¶åˆ›å»ºæ–°è¿ç§»
npx prisma migrate dev --name init --create-only
```

### Q4: å‰ç«¯ä»ç„¶æ˜¾ç¤ºMockæ•°æ®

1. åˆ·æ–°æµè§ˆå™¨é¡µé¢
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
3. æŸ¥çœ‹Networkæ ‡ç­¾ï¼Œæ£€æŸ¥APIè¯·æ±‚æ˜¯å¦æˆåŠŸ
4. æŸ¥çœ‹Consoleæ ‡ç­¾ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯

## æ¨èæµç¨‹

å¯¹äºå¿«é€Ÿæµ‹è¯•ï¼Œæ¨èä½¿ç”¨Dockeræ–¹æ¡ˆï¼š

```bash
# 1. å¯åŠ¨PostgreSQLï¼ˆDockerï¼‰
docker run -d \
  --name webnote-postgres \
  -e POSTGRES_USER=admin \
  -e POSTGRES_PASSWORD=password \
  -e POSTGRES_DB=example_db \
  -p 5432:5432 \
  -v pgdata:/var/lib/postgresql/data \
  postgres:14-alpine

# 2. è¿è¡Œè¿ç§»
cd packages/backend
npx prisma migrate deploy

# 3. é‡å¯åç«¯
# åœæ­¢å½“å‰åç«¯ï¼ˆCtrl+Cï¼‰ï¼Œç„¶åé‡æ–°å¯åŠ¨
npm run dev

# 4. æµ‹è¯•
curl http://127.0.0.1:3000/api/health
```

## æ•°æ®åº“schema

å½“å‰é¡¹ç›®ä½¿ç”¨çš„æ•°æ®åº“è¡¨ç»“æ„ï¼ˆåœ¨`packages/backend/prisma/schema.prisma`ä¸­å®šä¹‰ï¼‰ï¼š

- `users` - ç”¨æˆ·è¡¨
- `notes` - ç¬”è®°è¡¨
- `folders` - æ–‡ä»¶å¤¹è¡¨
- `daily_reviews` - æ¯æ—¥å¤ç›˜è¡¨
- `sync_queue` - åŒæ­¥é˜Ÿåˆ—è¡¨
- `backups` - å¤‡ä»½è¡¨

## ä¸‹ä¸€æ­¥

æ•°æ®åº“å¯åŠ¨åï¼š
1. å–æ¶ˆæ³¨é‡Š`packages/web/src/App.tsx`ä¸­çš„é‰´æƒä»£ç 
2. åˆ·æ–°æµè§ˆå™¨
3. æ³¨å†Œ/ç™»å½•æµ‹è¯•
4. åˆ›å»ºç¬”è®°å’Œå¤ç›˜

## è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. åç«¯æ—¥å¿—ï¼š`packages/backend`ç»ˆç«¯è¾“å‡º
2. PostgreSQLæ—¥å¿—ï¼š`docker logs webnote-postgres`
3. æµè§ˆå™¨æ§åˆ¶å°ï¼šF12 â†’ Consoleæ ‡ç­¾
